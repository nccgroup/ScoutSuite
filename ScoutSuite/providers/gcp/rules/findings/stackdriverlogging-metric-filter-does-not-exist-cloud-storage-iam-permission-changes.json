{
    "description": "Log Metric Filter Doesn't Exist for Cloud Storage IAM Permission Changes",
    "rationale": "Monitoring changes to cloud storage bucket permissions may reduce the time needed to detect and correct permissions on sensitive cloud storage buckets and objects inside the bucket.",
    "remediation": "From console: <ol><li>Go to <samp>Logging/Logs</samp> by visiting https://console.cloud.google.com/logs/metrics and click \"CREATE METRIC\".</li><li>Click the down arrow symbol on the <samp>Filter Bar</samp> at the rightmost corner and select <samp>Convert to Advanced Filter</samp>.</li><li>Clear any text and add: <br> <samp> resource.type=gcs_bucket AND protoPayload.methodName=\"storage.setIamPermissions\"</samp></li><li>Click <samp>Submit Filter</samp>. The logs display based on the filter text entered by the user.</li><li>In the <samp>Metric Editor</samp> menu on the right,fill out the name field. Set <samp>Units</samp> to <samp>1</samp>(default) and the <samp>Type</samp> to <samp>Counter</samp>. This ensures that the log metric counts the number of log entries matching the advanced logs query.</li><li>Click <samp>CreateMetric</samp>.</li></ol>",
    "compliance": [
        {
            "name": "CIS Google Cloud Platform Foundations",
            "version": "1.1.0",
            "reference": "2.10"
        }
    ],
    "references": [
        "https://cloud.google.com/logging/docs/logs-based-metrics/",
        "https://cloud.google.com/monitoring/custom-metrics/",
        "https://cloud.google.com/monitoring/alerts/",
        "https://cloud.google.com/logging/docs/reference/tools/gcloud-logging",
        "https://cloud.google.com/storage/docs",
        "https://cloud.google.com/storage/docs/access-control/iam-roles"
    ],
    "dashboard_name": "Logging Configurations",
    "path": "stackdriverlogging.projects.id.logging_metrics.id",
    "conditions": [
        "and",
        [
            "stackdriverlogging.projects.id.logging_metrics.id.cloud_storage_iam_permission_change",
            "false",
            ""
        ]
    ],
    "id_suffix": "cloud_storage_iam_permission_change"
}